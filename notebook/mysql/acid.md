### 数据库事务及隔离级别


#### 1. 什么是事务
事务是关系数据库的基本特性，指的是对数据的一组操作要么全部执行成功，要么全部回退到未执行状态。
举个例子说明事务。一个电商平台的会员用户下了一个200元的订单，使用账户余额支付，支付过程执行如下

    1 检查会员余额高于200元。
    2 从余额账户中减去200元。
    3 订单状态改为已支付。

上述三个步骤必须在一个事务中完成，任何一步失败，则必须撤销其它所有步骤的执行，数据库术语称作回滚。

事务的SQL语句如下：
    
    1 START TRANSACTION;
    2 SELECT balance FROM account WHERE member_id = 1357;
    3 UPDATE account SET balance = balance - 200.00 WHERE member_id = 1357;
    4 UPDATE order SET status = '已支付' WHERE order_id = 10000; 
    5 COMMIT;

假如执行第4条语句时，服务器故障，导致更新订单状态的操作没有执行，此时用户余额已经扣除了，如果不对前面的执行进行回滚，则出现了数据不一致。

#### 2. 事务的ACID特性
一个完整的事务系统要满足ACID特性。原子性(Atomicity)、一致性(Consistency)、隔离性(Isolation)、持久性(Durability)。
- 原子性

  一个事务一个完整的不可分割的最小工作单元，事务中所有的语句要么全部执行成功，有一条或多条语句执行失败，则所有语句都要回滚，使数据恢复到事务执行前的初始状态。
- 一致性
  
  数据库中的数据从一个一致性的状态转换到另外一个一致性的状态。上面的例子中，在更新订单状态未成功时，会员账户的余额也不会减少，因为整个事务都被回滚了，执行账户余额减少的操作并没有被提交。
- 隔离性
  
通产来说，一个事务所做的修改在最终提交以前，对其它事务是不可见的。上面的例子中，在第三条语句执行完成后，COMMIT语句执行前，假设有一个账户余额汇总程序开始运行，则其看到的该会员账户余额并没有被减去200元。
- 持久性
  
一旦事务提交，则其对数据所做的修改就会永久保存到数据库中。

#### 3. 事务的隔离级别

SQL标准中定义了四种隔离级别，分别是未提交读（Read Uncommitted)、提交读（Read Committed）、可重复读(Repeatable Read)、可串行化(SERIALIZABLE)。